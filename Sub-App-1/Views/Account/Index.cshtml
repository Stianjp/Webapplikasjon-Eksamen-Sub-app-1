@using Sub_App_1.Models;

@{
    ViewBag.Title = "Account";
}

<div class="container mt-5">
    <!-- Error message -->
    @if(ViewBag.Error != null) {
        <div class="alert alert-danger">
            @ViewBag.Error
        </div>
    }

    <!-- Further detailed error message(s) if any (like too short pwd) -->
    @if(ViewData.ModelState.Count > 0) {
        <ul>
            @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors)) {
                <li>@error.ErrorMessage</li>
            }
        </ul>
    }

    @if(User.Identity != null && User.Identity.IsAuthenticated) {
        <h2>Welcome, @User.Identity.Name!</h2>
        <p>You are currently logged in.</p>
        <form asp-action="Logout" method="post"><button type="submit" class="btn btn-danger">Logout</button></form>
        @* <hr></hr>
        <a asp-controller="Account" asp-action="ChangePassword" class="btn btn-primary">Change Password</a>
        <a asp-controller="Account" asp-action="DeleteAccount" class="btn btn-danger">Delete Account</a> *@
        
        <hr />

        <a asp-controller="Account" asp-action="ChangePassword" class="btn btn-primary">Change Password</a>
        <a asp-controller="Account" asp-action="DeleteAccount" class="btn btn-danger">Delete Account</a>

        @if (User.IsInRole("Admin")) {
            <hr />
            <h3>Admin Control Panel</h3>
            <a asp-controller="Admin" asp-action="UserManager" class="btn btn-warning">User Manager</a>
            <!-- we can add more administrative buttons here if needed -->
        }
    } else {
        <div class="row">
            <!-- Login Section -->
            <div class="col-md-4 offset-md-1">
                <h2 class="mb-4">Login</h2>
                <form asp-action="Login" method="post">
                    <div class="form-group mb-3">
                        <label for="username" class="form-label">Username</label>
                        <input type="text" id="username" name="username" class="form-control" placeholder="Enter your username" required />
                    </div>
                    <div class="form-group mb-3">
                        <label for="password" class="form-label">Password</label>
                        <input type="password" id="password" name="password" class="form-control" placeholder="Enter your password" required />
                    </div>
                    <button type="submit" class="btn btn-primary w-100">Login</button>
                </form>
            </div>

            <!-- Register Section -->
            <div class="col-md-4 offset-md-1">
                <h2 class="mb-4">Register</h2>
                <form asp-action="Register" method="post">
                    <div class="form-group mb-3">
                        <label for="reg-username" class="form-label">Username</label>
                        <input type="text" id="reg-username" name="username" class="form-control" placeholder="Choose a username" required />
                    </div>
                    <div class="form-group mb-3">
                        <label for="reg-password" class="form-label">Password</label>
                        <input type="password" id="reg-password" name="password" class="form-control" placeholder="Choose a password" required />
                    </div>
                    <div class="form-group mb-3">
                        <label for="role" class="form-label">Account Type</label>
                        <select id="role" name="role" class="form-control">
                            <option value="@UserRoles.RegularUser">Regular User</option>
                            <option value="@UserRoles.FoodProducer">Food Producer</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-success w-100">Register</button>
                </form>
            </div>
        </div>

        @* TODO: *@
        @* <div class="row mt-5">
            <!-- Browse as Guest Section -->
            <div class="col-md-8 offset-md-2 text-center">
                <h2>Browse as Guest</h2>
                <a href="@Url.Action("BrowseAsGuest", "Account")" class="btn btn-outline-secondary mt-3">Browse as Guest</a>
            </div>
        </div> *@
    }
</div>
